name: iOS starter workflow

on:
  push:
    ignore-branches: [ "master" ]

jobs:
  build-and-test:
    name: "Test on ï£¿ iOS Simulator (xcode: 14.2.0, macos: latest)"
    runs-on: 'macos-latest'
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - uses: maxim-lobanov/setup-xcode@v1.2.3
        with:
          xcode-version: '14.2.0'
      - name: Clone Mock Server
        uses: actions/checkout@v3
        with:
          repository: frontegg/frontegg-mock-server
          ssh-key: ${{ secrets.MOCK_SERVER_SSH_KEY }}
          path: mocker
      - name: List Mock Server
        run: ls -la "./mocker"
      - name: Double-check macOS version (macos-latest)
        run: sw_vers
      - name: Double-check Xcode.app selected
        run: xcode-select --print-path
      - name: Check xcodebuild version
        run: xcodebuild -project demo/demo.xcodeproj -version
      - name: Check xcode embedded SDKs
        run: xcodebuild -project demo/demo.xcodeproj -showsdks
      - name: Show buildable schemes
        run: xcodebuild -project demo/demo.xcodeproj -list
      - name: Show eligible build destinations for the "demo"
        run: xcodebuild -project demo/demo.xcodeproj -showdestinations -scheme "demo"
      - uses: mxcl/xcodebuild@v1.9.2
        with:
          platform: "iOS"
          scheme: "demo"
          action: "test"
          working-directory: "demo"
          code-coverage: false
          verbosity: xcpretty
          upload-logs: always
#      - name: Build
#        env:
#          scheme: ${{ 'demo' }}
#          platform: ${{ 'iOS Simulator' }}
#        run: |
#          xcodebuild build-for-testing -scheme "$scheme" -project demo/demo.xcodeproj -destination "platform=$platform,name=iPhone 14 Pro"
#      - name: Test
#        env:
#          scheme: ${{ 'demo' }}
#          platform: ${{ 'iOS Simulator' }}
#        run: |
#          cd demo
#          xcodebuild test-without-building -scheme "$scheme" -project demo.xcodeproj -destination "platform=$platform,name=iPhone 14 Pro"
